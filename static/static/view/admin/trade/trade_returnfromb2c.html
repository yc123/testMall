<style type="text/css">
.minTitle {
	font-weight: 600;
	font-size: 17px;
}

.boxbank{
	padding: 0px 15px;
}

.marginltb {
    margin-left: 20px;
    margin-top: 10px;
    margin-bottom: 10px;
}

.padding-bottom-10 {
	padding-bottom: 10px;
}
</style>
<div class="row-fluid sortable">		
	<div class="box">
		<div class="box-header well" data-original-title>
			<i class="icon-user"></i> 平台退货单
		</div>
		<div class="box-content">
			<!-- ng-tableStart -->
			<div class="fullscreen" style="padding: 10px;">
				<div class="row">
					<div class="col-sm-1">
						共<span class="badge">{{returnfmb2cTableParams.total()}} </span>条
					</div>
					<div class="col-sm-7">
						<div class="btn-group" role="group" aria-label="...">
							<button type="button" class="btn btn-default" ng-class="{'btn-primary':active=='tobeshippedback'}" ng-click="setActive('tobeshippedback')">待回寄</button>
							<button type="button" class="btn btn-default" ng-class="{'btn-primary':active=='inspecting'}" ng-click="setActive('inspecting')">验货中</button>
							<button type="button" class="btn btn-default" ng-class="{'btn-primary':active=='received'}" ng-click="setActive('received')">已收货</button>
						</div>
					</div>
					<div class="col-sm-4">
						<div class="input-group">
							<input placeholder="请输入订单号查询" ng-search="onSearch()" class="form-control"
								size="16" type="text" ng-model="keyword">
							<span class="input-group-btn">
								<button class="btn btn-primary" type="button" ng-click="onSearch()">搜索</button>
							</span>
						</div>
					</div>
				</div>
				<table ng-table="returnfmb2cTableParams" class="table table-bordered table-striped" style="margin-top: 10px;">
					<thead>
						<tr>
							<th class="text-center" width="50">序号</th>
							<th class="text-center" width="auto">退货单号</th>
							<th class="text-center" width="80">买方姓名</th>
							<th class="text-center" width="150">供应商企业名称</th>
							<th class="text-center" width="100">总金额</th>
							<th class="text-center" width="80">数量</th>
							<th class="text-center" width="120">创建时间</th>
							<th class="text-center" width="80">退货单状态</th>
							<th class="text-center" width="120">客户退货单</th>
							<th class="text-center" width="150" ng-show="active=='tobeshippedback'">操作</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="return in $data">
							<td class="text-center">{{($index + 1)}}</td>
							<td class="text-center"><a ng-href="admin_n#/trade/returnfromb2c/{{return.returnid | EncryptionFilter}}">{{return.returnid}}</a></td>
							<td class="text-center">{{return.buyername}}</td>
							<td class="text-center">{{return.sellername}}</td>
							<td class="text-center">{{return.currency}}&nbsp;{{return.price | number:2}}</td>
							<td class="text-center">{{return.qty}}</td>
							<td class="text-center">{{return.createtime | date: "yyyy-MM-dd HH:mm"}}</td>
							<td class="text-center">{{return.status | statusAndTypeFilter}}</td>
							<th class="text-center"><a ng-href="admin_n#/trade/returnfromb2c/{{return.rfcid | EncryptionFilter}}">{{return.rfcid}}</a></th>
							<td class="text-center" ng-show="active=='tobeshippedback'">
								<a ng-show="active=='tobeshippedback'" ng-click="sendReturn(return)">
									<button type="button" class="btn btn-default btn-sm" 
									>确认发货</button></a>
							<!--  <a ng-show="active=='received'"ng-click="ensurePaid(return)">
									<button type="button" class="btn btn-default btn-sm" 
									>确认退款</button></a> -->
									
	<!-- 							<a ng-show="active=='received'"ng-click="onesEnsure(return)">
									<button type="button" class="btn btn-default btn-sm" 
									>确认退款</button></a> -->
								
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<!-- ng-tableEnd -->
		</div>
	</div><!--/span-->
	<a id="bottom"></a>
</div><!--/row-->

<!-- 批量  确认出货界面 开始代码  -->
<div ng-if="deliveryStatusEntryCheck && active=='tobeshippedback'">
	<div class="row-fluid sortable">
		<div class="box">
			<div class="box-header well">
				<i class="icon-user"></i> 确认发货操作
			</div>
			<div class="box-content" style="font-size: 15px; ">
				<div ng-repeat="return in batchReturn" class="repeatBorder">
					<div class="divTitle" ng-click="deliveryExpose(return)">
						<span role="button"  ng-if="return.expose" style="margin-left: 10px;"><i class="fa fa-angle-down"></i>&nbsp;</span>
						<span role="button" ng-if="!return.expose" style="margin-left: 10px;"><i class="fa fa-angle-up"></i>&nbsp;</span>
						<span >订单号:</span>
						<span ng-bind="::return.returnid"></span>
					</div>
					<div ng-if="return.expose" style="margin-left: 32px;">
						<div class="marginleftline">
							<div class="marginleftline row">
								<span class="col-xs-2"><strong>总金额</strong></span>
								<span class="col-xs-2">{{return.currency}}&nbsp;{{return.price | number:2}}</span>
								<span class="col-xs-2"><strong>数量</strong></span>
								<span class="col-xs-6"  ng-bind="return.qty"></span>
							</div>
						</div>
						<div class="marginleftline row">
							<span class="col-xs-2"><strong>联系方式</strong></span>
							<span class="col-xs-2" ng-bind="return.jsonAddress.tel"></span>
							<span class="col-xs-2"><strong>创建时间</strong></span>
							<span class="col-xs-6" ng-bind="return.createtime | date: 'yyyy-MM-dd HH:mm'"></span>
						</div>
						<div class="marginleftline row">
							<span class="col-xs-2"><strong>收货人</strong></span>
							<span class="col-xs-2" ng-bind="return.jsonAddress.name"></span>
							<span class="col-xs-2"><strong>收货地址</strong></span>
							<span ng-bind="return.jsonAddress.area" class="col-xs-2"></span>
							<span ng-bind="return.jsonAddress.detailAddress" class="col-xs-4"></span>
						</div>
					</div>
				</div>
				<div>
					<h4><strong>发货信息</strong></h4>
					<hr style="margin-top: 5px; margin-bottom: 15px;">
				</div>
				<div style="line-height: 30px; margin-left: 33px">
					<div class="row">
						<div class="col-xs-12 padding-bottom-10">
							<div class="col-xs-2"><strong>物流公司</strong></div>
							<div class="col-xs-3">
								<select ng-required="true" class="form-control" ng-model="logistics.companyName"
									ng-options="exp.name for exp in express">
									<option value="">请选择物流公司名称</option>
								</select>
								<!-- <input type="text" ng-model="logistics.companyName" class="input span12 display-inline" placeholder="物流公司名称" name="companyName" ng-required="true"/> -->
							</div>
						</div>
						<div class="col-xs-12 padding-bottom-10">
							<div class="col-xs-2"><strong>快递单号</strong></div> 
							<div class="col-xs-5"> 
							<input type="text" ng-model="logistics.number" class="input form-control" ng-pattern="/^\+?[1-9][0-9]*$/" placeholder="快递单号(数字型)" /> 
								<span ng-if="!logistics.number" class="text-warning">请填写正确的快递号</span>
							</div>
						</div>
					</div>
					<div ng-repeat="addr in sendAddr" class="row">
						<div>
							<span class="col-xs-1"><strong>发货人</strong></span>
							<span class="col-xs-2" ng-bind="::addr.name"></span>
							<span class="col-xs-2"><strong>联系方式</strong></span>
							<span class="col-xs-7" ng-bind="::addr.tel"></span>
						</div>
						<div>
							<span class="col-xs-2"><strong>发货地址</strong></span>
							<span class="col-xs-2" ng-bind="::addr.area"></span>
							<span class="col-xs-7"  ng-bind="::addr.detailAddress"></span>
						</div>
					</div>
				</div>	
				<div style="text-align: center;">
					<a class="btn btn-primary" ng-click="entryCheck()">录入并核对信息</a>
				</div>
			</div>
		</div>
	</div>
</div>

<div ng-if="deliveryStatusSaveDelivery && active=='tobeshippedback'">
	<div class="row-fluid sortable">
		<div class="box" >
			<div class="box-header well">
				<i class="icon-user"></i> 确认发货操作
			</div>
			<div class="box-content" style="font-size: 15px; ">
				<div ng-repeat="return in batchReturn" class="repeatBorder" style="margin-bottom: 30px;" ng-init="return.expose=true">
					<div class="divTitle" ng-click="deliveryExpose(return)">
						<span role="button" ng-if="return.expose" style="margin-left: 10px;"><i class="fa fa-angle-down"></i>&nbsp;</span>
						<span role="button" ng-if="!return.expose" style="margin-left: 10px;"><i class="fa fa-angle-up"></i>&nbsp;</span>
						<span ng-bind="::return.returnid"></span>
						<span ng-bind="::return.logistics.companyName" style="margin-left: 20px; margin-right: 20px;"></span>
						<span ng-bind="::return.logistics.number"></span>
					</div>
					<div ng-if="return.expose" style="margin-left: 30px; font-size: 15px; line-height: 30px;">
						<div class="marginTop10">
							<div class="row">
								<span class="col-xs-2">总金额</span>
								<span class="col-xs-2">{{return.currency}}&nbsp;{{return.price | number:2}}</span>
								<span class="col-xs-2">创建时间</span>
								<span class="col-xs-6" ng-bind="return.createtime | date: 'yyyy-MM-dd HH:mm'"></span>
							</div>
						</div>
						<div class="marginTop10">
							<div class="row">
								<span class="col-xs-2">收货人姓名</span>
								<span class="col-xs-2" ng-bind="::return.jsonAddress.name"></span>
								<span class="col-xs-2">收货人联系方式</span>
								<span class="col-xs-6" ng-bind="::return.jsonAddress.tel"></span>
							</div>
							<div class="row">
								<span class="col-xs-2">发货人姓名</span>
								<span class="col-xs-2" class="marginRight98" ng-bind="::selectSendAddr.name"></span>
								<span class="col-xs-2">发货人联系方式</span>
								<span class="col-xs-6" ng-bind="::selectSendAddr.tel"></span>
							</div>
						</div>
						<div class="marginTop10">
							<div class="row">
								<span class="col-xs-2">收货人地址</span>
								<span class="col-xs-2" ng-bind="return.jsonAddress.area"></span>
								<span class="col-xs-7" ng-bind="return.jsonAddress.detailAddress"></span>
							</div>
							<div class="row">
								<span class="col-xs-2">发货人地址</span>
								<span class="col-xs-2" ng-bind="::selectSendAddr.area"></span>
								<span class="col-xs-7" ng-bind="::selectSendAddr.detailAddress"></span>
							</div>
						</div>
					</div>
				</div>
				<div style="text-align: center; margin-bottom: 15px;">
					<a class="btn btn-primary" ng-click="back()">返回上一步</a>
					<a class="btn btn-primary" ng-click="confirmAndDelivery()">确认并出货</a>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 退货单退款 开始代码  -->
<a id="batchCheckMoney" style="color: white;">batchCheckMoney</a>
<div ng-if="batchCheckStatus">
	<div class="row-fluid sortable">
		<div class="box" >
			<div class="box-header well">
				<h2><i class="icon-user"></i> 确认退款操作</h2>
			</div>
			<div class="box-content">
				<div class="repeatBorder row-fluid">
					<div class="divTitle boxbank span12 f12">
						<span>订单号:</span> <span ng-repeat="recepit in batchRecepit" class="text-inverse">{{recepit.returnid}}&nbsp;</span>
					</div>
				</div>
				<div class="boxbank">
					<div class="row-fluid ">
						<span class="minTitle span10">平台应付账户</span>
						<div role="button" class="span2"
							ng-click="newAccount()">
							<i class="fa fa-plus-square"></i>&nbsp;新增账户
						</div>
					</div>
					<div class="row-fluid " ng-repeat="b2cAccountInfo in b2cAccountInfos" ng-if="salexpose">
						<div class="span10" ng-class="{true : 'select', false: 'diselect'}[b2cAccountInfo.id == b2cAccount.id]">
							<div class="row-fluid" ng-click="select(b2cAccountInfo)" >
								<span class="span2 text-center" ng-bind="::b2cAccountInfo.accountname" ></span>
								<span class="span3 text-center" ng-bind="::b2cAccountInfo.filterAccount"></span>
								<span class="span3 text-center" ng-bind="::b2cAccountInfo.bankname">&nbsp;&nbsp;<i
										class="fa fa-credit-card"></i></span>
							 	<span class="span4 text-center text-inverse"><span role="button"
									ng-click="newAccount(b2cAccountInfo)"><i class="fa fa-edit"></i>&nbsp;编辑</span>&nbsp;
								<span role="button" ng-click="deleteAccount(b2cAccount)"><i
										class="fa fa-remove"></i>&nbsp;删除</span></span>
							</div>
						</div>
						<div class="span2 pull-right" style="padding-top: 25px;" ng-show="$index == 0">
								<span role="button" ng-if="!salexpose"
									ng-click="doExpose(true, false)"><i
									class="fa fa-angle-double-down"></i>&nbsp;展开列表</span> <span
									role="button" ng-if="salexpose"
									ng-click="doExpose(false, false)"><i
									class="fa fa-angle-double-up"></i>&nbsp;收起列表</span>
						</div>
					</div>
					<div class="row-fluid" ng-if="!salexpose">
						<div class="span10" ng-class="{true : 'select', false: 'diselect'}[b2cAccount.id == b2cAccount.id]" >
							<div class="row-fluid">
								<span class="span2 text-center" ng-bind="b2cAccount.accountname" ></span>
								<span class="span3 text-center" ng-bind="b2cAccount.filterAccount"></span>
								<span class="span3 text-center" ng-bind="b2cAccount.bankname"><i
										class="fa fa-credit-card"></i></span>
								<span class="span4 text-center text-inverse"><span role="button"
									ng-click="newAccount(b2cAccount)"><i class="fa fa-edit"></i>&nbsp;编辑</span>&nbsp;
								<span role="button" ng-click="deleteAccount(b2cAccount)"><i
										class="fa fa-remove"></i>&nbsp;删除</span></span> 
							</div>
						</div>
						<div class="span2 pull-right" style="padding-top: 25px;" >
								<span role="button" ng-if="!salexpose"
									ng-click="doExpose(true, false)"><i
									class="fa fa-angle-double-down"></i>&nbsp;展开列表</span> <span
									role="button" ng-if="salexpose"
									ng-click="doExpose(false, false)"><i
									class="fa fa-angle-double-up"></i>&nbsp;收起列表</span>
						</div>
					</div>
			
					<label class="minTitle marginTop30">客户应收账户</label>
					<div class="row-fluid" ng-if="!custExpose">
						<div class="span10" ng-class="{true : 'select', false: 'diselect'}[custAccount.id == custAccount.id]" >
							<div class="row-fluid" ng-show="custAccount != null && custAccount.length != 0">
								<span class="span2 text-center" ng-bind="::custAccount.accountname" ></span>
								<span class="span3 text-center" ng-bind="::custAccount.filterAccount"></span>
								<span class="span3 text-center" ng-bind="::custAccount.bankname"><i
										class="fa fa-credit-card"></i></span>
							</div>
							<div class="row-fluid" ng-show="custAccount == null || custAccount.length == 0">
								<span class="span12 text-center text-warning f14"><i class="fa fa-warning"></i>&nbsp;未能找到单据对应客户的企业银行账户！</span>
							</div>
						</div>
					</div>
					<div class="row-fluid marginTop20">
						<div class="span2">
							<label class="f16 marginTop5"><strong>转账日期</strong></label>
						</div>
						<div class="span7">
							<datetrigger name="transferTime" model="transferTime"
							format="yyyy年MM月dd日" class="col-md-5" max-date="maxDate"
							style="line-height: 28px; border-radius: 5px; width: 70%; font-size: 15px;"></datetrigger>
						</div>
					</div>
					<div class="row-fluid marginTop20">
						<div class="row-fluid">
							<div class="span2">
								<label class="minTitle">交易图片</label>
							</div>
						</div>
						<div class="row-fluid marginltb">
							<label><span>*</span>付款截图：</label>
							<div class="marginBottom5">
								<img class="img-thumbnail" ng-src="{{imageUrl}}"
									style="width: 100px; height: 100px;"
									ng-click="showImageDialog()"> 
							</div>
							<span class="text-muted" >建议图片尺寸在750*750像素以上，图片请避免全文字</span>
						</div>
					</div>
				</div>
			</div>
			<div class="box-content" style="font-size: 15px; ">
				<div class="row-fluid ">
					<div class="span11 text-center">
						<span class="text-inverse">总价：{{batchRecepit[0].price}}</span>&nbsp;&nbsp;
						<button class="btn btn-primary" ng-click="confirm()" 
							ng-disabled=" !b2cAccount || !custAccount || !transferTime">确认并付款</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>